'use client';

import Image from 'next/image';
import { useEffect, useRef, useState } from 'react';

export default function Page() {
  const [phase, setPhase] = useState(0);
  const lineRef = useRef<HTMLSpanElement | null>(null);
  const [showSticky, setShowSticky] = useState(false);

  useEffect(() => {
    const el = lineRef.current;
    if (!el) return;
    const onEnd = () => {
      setPhase((prev) => (prev + 1) % 4);
    };
    el.addEventListener('animationend', onEnd);
    return () => el.removeEventListener('animationend', onEnd);
  }, [phase]);

  // Sticky desktop header on scroll
  useEffect(() => {
    const onScroll = () => {
      if (typeof window !== 'undefined') {
        setShowSticky(window.scrollY > 80);
      }
    };
    window.addEventListener('scroll', onScroll, { passive: true } as any);
    onScroll();
    return () => window.removeEventListener('scroll', onScroll as any);
  }, []);

  // Reveal-on-scroll for section cards
  useEffect(() => {
    if (typeof window === 'undefined') return;
    const targets = Array.from(document.querySelectorAll<HTMLElement>('[data-reveal]'));
    if (targets.length === 0) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          const el = entry.target as HTMLElement;
          if (entry.isIntersecting) {
            el.classList.add('is-visible');
          } else {
            el.classList.remove('is-visible');
          }
        });
      },
      { threshold: 0.15, rootMargin: '0px 0px -10% 0px' }
    );

    targets.forEach((el) => observer.observe(el));
    return () => observer.disconnect();
  }, []);

  const headingSub = phase === 0 ? 'Cloud' : phase === 1 ? 'Leather' : phase === 2 ? 'Shoes' : 'Loafers';
  const description =
    phase === 0
      ? 'Cocok dipakai harian maupun saat santai dan mempunyai bahan lembut'
      : phase === 1
      ? 'Desain minimalis dengan bahan kulit yang berkilau'
      : phase === 2
      ? 'Nyaman dipakai dengan bahan lembut terasa di kaki'
      : 'Tampil keren dengan sepatu nyaman di kaki';
  const activeLabel = phase === 0 ? '01._' : phase === 1 ? '02._' : phase === 2 ? '03._' : '04._';
  const mainImg =
    phase === 0
      ? '/images/test1.png'
      : phase === 1
      ? '/images/test2.png'
      : phase === 2
      ? '/images/test3.png'
      : '/images/test4.png';
  const productImg =
    phase === 0
      ? '/images/test1-produk.png'
      : phase === 1
      ? '/images/test2-produk.png'
      : phase === 2
      ? '/images/test3-produk.png'
      : '/images/test4-produk.png';
  const phaseTitle =
    phase === 0
      ? 'Sock Sneakers Cloud'
      : phase === 1
      ? 'Sock Sneakers Leather'
      : phase === 2
      ? 'Gladiator Sandals Shoes'
      : 'Gladiator Canvas Loafers';

  return (
    <main className="min-h-screen">
      {/* Sticky header (desktop) */}
      {showSticky && (
        <div className="hidden md:flex fixed top-0 left-0 right-0 z-50 bg-white/95 backdrop-blur-sm border-b border-gray-200">
          <div className="w-full flex items-center justify-between px-6 md:px-8 lg:px-10 py-5">
            <div className="flex items-center gap-2">
              <button
                type="button"
                aria-label="Buka menu"
                className="p-1 rounded hover:opacity-80 focus:outline-none focus-visible:ring-2 focus-visible:ring-black"
              >
                <Image src="/images/sidebar.png" alt="Menu" width={40} height={40} />
              </button>
              <a href="/" aria-label="Meoris beranda" className="select-none">
                <span className="font-heading font-bold text-3xl tracking-wide text-black">MEORIS</span>
              </a>
            </div>
            <div className="flex items-center gap-5">
              <a href="#" aria-label="Cari">
                <Image src="/images/search.png" alt="Search" width={36} height={36} />
              </a>
              <a href="#" aria-label="Favorit" className="relative">
                <Image src="/images/favorit.png" alt="Favorit" width={36} height={36} />
                <span className="absolute -top-2 -right-2 min-w-4 h-4 px-1 rounded-full bg-black text-white text-[10px] leading-4 text-center">0</span>
              </a>
              <a href="#" aria-label="Keranjang" className="relative">
                <Image src="/images/cart.png" alt="Cart" width={36} height={36} />
                <span className="absolute -top-2 -right-2 min-w-4 h-4 px-1 rounded-full bg-black text-white text-[10px] leading-4 text-center">0</span>
              </a>
              <a href="#" aria-label="Akun">
                <Image src="/images/user.png" alt="User" width={36} height={36} />
              </a>
            </div>
          </div>
        </div>
      )}
      {/* Section Pertama: mengikuti split background dari body */}
      <section className="relative grid min-h-[80vh] md:min-h-screen grid-cols-2 split-bg pt-[64px] md:pt-0">
        {/* Desktop header row: brand left, icons right (aligned) */}
        <div className="hidden md:flex absolute top-12 left-6 right-10 z-20 items-center justify-between">
          <div className="flex items-center gap-2">
            <button
              type="button"
              aria-label="Buka menu"
              className="p-1 rounded hover:opacity-80 focus:outline-none focus-visible:ring-2 focus-visible:ring-black"
            >
              <Image src="/images/sidebar.png" alt="Menu" width={34} height={34} />
            </button>
            <a href="/" aria-label="Meoris beranda" className="select-none">
              <span className="font-heading font-bold text-xl md:text-2xl lg:text-3xl tracking-wide text-black">MEORIS</span>
            </a>
          </div>
          <div className="flex items-center gap-4 lg:gap-5">
            <a href="#" aria-label="Cari">
              <Image src="/images/search.png" alt="Search" width={34} height={34} />
            </a>
            <a href="#" aria-label="Favorit" className="relative">
              <Image src="/images/favorit.png" alt="Favorit" width={34} height={34} />
              <span className="absolute -top-2 -right-2 min-w-4 h-4 px-1 rounded-full bg-black text-white text-[10px] leading-4 text-center">0</span>
            </a>
            <a href="#" aria-label="Keranjang" className="relative">
              <Image src="/images/cart.png" alt="Cart" width={34} height={34} />
              <span className="absolute -top-2 -right-2 min-w-4 h-4 px-1 rounded-full bg-black text-white text-[10px] leading-4 text-center">0</span>
            </a>
            <a href="#" aria-label="Akun">
              <Image src="/images/user.png" alt="User" width={34} height={34} />
            </a>
          </div>
        </div>
        {/* Mobile header: MEORIS left, icons right */}
        <div className="md:hidden fixed top-0 left-0 right-0 z-40 bg-white/95 backdrop-blur-sm border-b border-gray-200">
          <div className="flex items-center justify-between px-5 py-4">
            <span className="font-heading font-bold text-xl tracking-wide text-black select-none">MEORIS</span>
            <div className="flex items-center gap-5">
              <a href="#" aria-label="Cari">
                <Image src="/images/search.png" alt="Search" width={32} height={32} />
              </a>
              <a href="#" aria-label="Favorit" className="relative">
                <Image src="/images/favorit.png" alt="Favorit" width={32} height={32} />
                <span className="absolute -top-2 -right-2 min-w-4 h-4 px-1 rounded-full bg-black text-white text-[10px] leading-4 text-center">0</span>
              </a>
              <a href="#" aria-label="Keranjang" className="relative">
                <Image src="/images/cart.png" alt="Cart" width={32} height={32} />
                <span className="absolute -top-2 -right-2 min-w-4 h-4 px-1 rounded-full bg-black text-white text-[10px] leading-4 text-center">0</span>
              </a>
              <a href="#" aria-label="Akun">
                <Image src="/images/user.png" alt="User" width={32} height={32} />
              </a>
            </div>
          </div>
        </div>
        
        {/* Kiri (50%) - abu cerah: gambar test1.png di tengah */}
        <div className="relative z-0 flex items-center justify-center p-0 sm:p-0 md:p-10 bg-[#f3f4f6] md:bg-transparent">
          {/* Vertical deal labels (desktop/tablet only) */}
          <div className="hidden md:flex flex-col gap-2 absolute left-6 top-1/2 -translate-y-1/2 z-10">
            <span className={`font-heading ${phase === 0 ? 'text-black text-xl lg:text-2xl xl:text-3xl' : 'text-gray-500 text-base lg:text-xl xl:text-2xl'}`}>01._</span>
